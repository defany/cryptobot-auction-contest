# Результаты нагрузочного тестирования

## Окружение тестирования

### Генератор нагрузки (клиент)
| Параметр | Значение |
|--------|----------|
| Устройство | MacBook M3 Pro |
| ОЗУ | 16 GB |
| ОС | macOS |
| Инструмент | k6 |
| Тип теста | Смешанный (чтение + запись) |
| Длительность | ~2 минуты на запуск |

Нагрузка генерировалась локально с **MacBook M3 Pro**

---

## Локальный запуск (MacBook M3 Pro → backend)

### Ключевые метрики

| Метрика | Значение |
|-------|---------|
| Общий RPS | ~580–600 req/s |
| Устойчивый RPS (успешные запросы) | ~470–500 req/s |
| Средняя задержка | ~1.8 s |
| Median latency | ~80 ms |
| p90 latency | ~7.1 s |
| p95 latency | ~8.7 s |
| Процент ошибок | ~18–19% |
| Завершённые итерации | ~17 600 |
| Max VUs | ~3000 |

### Интерпретация

- **Пропускная способность** высокая: система обрабатывает до ~600 запросов в секунду.
- **Большинство запросов успешны** (≈99.9% чеков), ошибки в основном ожидаемые (domain / validation).
- **Latency распределение асимметричное**:
  - основная масса запросов быстрые (десятки миллисекунд),
  - хвост (p90–p95) формируется из-за конкурентных транзакций, блокировок и ожиданий
- Сценарии с высокой конкуренцией (bid storm) адекватно отрабатываются и масштабируются

В целом, локально система демонстрирует **хорошую устойчивость и высокую пропускную способность**, при этом узкие места уже находятся внутри бизнес-логики и БД, а не в сетевом или HTTP-слое

---

## Серверное окружение (production-like)

### Характеристики сервера
| Параметр | Значение |
|--------|----------|
| CPU | 1 vCPU |
| RAM | 1 GB |
| Disk | 30 GB SSD |
| Reverse proxy | nginx |
| Backend | Docker container |

### Полученные результаты

| Метрика | Значение |
|-------|---------|
| Устойчивый RPS | ~70 req/s |
| p95 latency | ~10–15 s |
| Ошибки | заметны при росте нагрузки |

### Комментарий

- В начальной конфигурации сервер **стабильно держал около 70 RPS**, что является нормальным результатом для:
  - 1 vCPU,
  - 1 GB RAM,
  - транзакционной логики с конкурентными обновлениями
- Дальнейшие попытки тюнинга (nginx, таймауты, HTTP/2, keepalive, proxy buffering) **привели к деградации**, а не к росту производительности: я не лучший девопс, поэтому хорошо подтюнить сервер у меня не получилось

Важно отметить: **проблема не в коде приложения**, а в сочетании ограниченного железа + агрессивной нагрузки + сетевых экспериментов

---

## Итог

- **Локально** система масштабируется до ~600 RPS и выше
- **На слабом сервере** реалистичный потолок — ~70 RPS
- Архитектура в целом рабочая и выдерживает высокий конкурентный доступ.
- Дальнейший рост RPS на сервере потребует:
  - увеличения CPU / RAM,
  - отдельного тюнинга БД,
  - аккуратного, измеряемого подхода к nginx и сети.
- UPD: 
	- При попытке убрать deadline у ретраев транзакции ситуация лучше не стала, а скорость ответа сервера скорее ухудшилась
	- Обновлен load тест с упором на ставки, нежели проверку аукционов, деградации не замечено, скорее наоборот увеличение RPS с 500 до 600

## Примечание 
Можно было бы **увеличить пропускную способность** системы добавив следующие части:
- Кеширование запросов в кеше перед базой данных
- Созданием нескольких инстансов приложения
- Подтюнив настройки транзакций у MongoDB (уровень и тп., зависит от бизнес задачи)

Можно было бы **удерживать большее кол-во клиентов**:
- При наличии circuit breaker'а, который бы ограничивал пропускную способность на пиках тем самым охлаждая сервер
- При наличии рейт лимитов, которые бы не давали слишком сильно и много спамить на сервер 

**Дополнительно**, Mongo DB, имхо, не лучший выбор для работы с транзакциями в данном случае так как при наличии нескольких инстансов время коммита подобной транзакции бы увеличивалось 
