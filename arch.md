# Архитектура проекта

Используемый стек: Node TS (Bun), Fastify, MongoDB + Prisma ORM, zod для валидации данных

# Слои
Проект следует слоистой архитектуре: Repo -> Service -> Controller

Из-за использования ORM труднее абстрагировать всю работу с бд, поэтому есть небольшие утечки абстракций, которые, впрочем, легко зарефакторить

Классы сервисного и репо слоев должны иметь Abstract Class который описывает входные и выходные значения методов, но это было упущено из-за небольшого кол-ва кода проекта, иначе пришлось бы и типы Prisma маппить в наши внутренние, которые бы определяли в доменной модели 

# Обработка запросов
Перед каждым запросом мы валидируем тело запроса еще до того, как начинаем авторизовывать юзера, защищаясь от возможности ддос аттак с невалидными телами запроса

Некоторые запросы запускают транзакции, которые при deadlock'ах или timeout'ах будут ретраиться (опции можно кастомизировать от вызова к вызову)

Кеш - не был добавлен, отдаем не более 100 самых высоких ставок + место пользователя в топе ставок. При желании можно дописать еще репо классы и обернуть запросы к бд через кеш (cache-through design)

# Возможные улучшения на сервере и с точки зрения бд:
- Накинуть индексы на таблицу ставок и пользователей по полям отвечающим за сумму ставки, ее статус, айди юзера, дабы ускорить запросы на фетчинги топов ставок и позиции юзера
- Развернуть несколько инстансов базы данных, где один является репликой и обрабатывает чисто селект запросы:
		С точки зрения приложения можно будет написать пул клиентов к призме и в зависимости от типа запроса (select/update) выбирать куда ходить
- Развернуть несколько инстансов хттп сервера, чтобы распределить нагрузку 